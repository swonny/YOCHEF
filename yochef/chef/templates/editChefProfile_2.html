{% extends 'base.html' %}
{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'css/editChefProfile_2.css' %}">
{% endblock %}
{% block content %}

    <form onsubmit="return formCheck()" name="editPost" action="{% url 'updatePost' %}" method="POST"  enctype="multipart/form-data">
    {% csrf_token %}
        <div class="edit-chef-wrapper">
            {% include 'editChefProfile_side.html' %}
                <div class="edit-content">
                    <section class="category-region">
                        <h2 class="category-region__header">카테고리 및 지역</h2>
                        <!-- 음식 카테고리 지정 -->
                        <article class="category__wrapper">
                            <h4 class="article-title article-title--top">카테고리</h4>
                            <select name="category" value="{{post.category|default:"0"}}">
                                <option value="0" {% if post.category == 0 %} selected {% endif %}>선택하세요.</option>
                                <option value="1" {% if post.category == 1 %} selected {% endif %}>뷔페/케이터링</option>
                                <option value="2" {% if post.category == 2 %} selected {% endif %}>한식</option>
                                <option value="3" {% if post.category == 3 %} selected {% endif %}>일식</option>
                                <option value="4" {% if post.category == 4 %} selected {% endif %}>중식</option>
                                <option value="5" {% if post.category == 5 %} selected {% endif %}>아시안</option>
                                <option value="6" {% if post.category == 6 %} selected {% endif %}>양식</option>
                                <option value="7" {% if post.category == 7 %} selected {% endif %}>채식</option>
                            </select>
                        </article>
                        <!-- // 음식 카테고리 지정 -->
                        
                        <!-- 지역 설정 -->
                        <article class="region-wrapper">
                            <h4 class="article-title article-title--top">지역 선택 </h4>
                            <div id="region-selection-all">
                                <div class="region-selection-wrapper">
                                    <select class="region-selection" name="residence" value="{{post.region|default:0}}"></select>
                                    <select id="region-detail-selection" name="residenceDetail" value="{{post.regionDetail|default:0}}"></select>
                                    <!-- 추후구현: 지역추가시 삭제버튼 -->
                                    <!-- <button onclick="delRegion(this)" class="delete-region"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnN2Z2pzPSJodHRwOi8vc3ZnanMuY29tL3N2Z2pzIiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeD0iMCIgeT0iMCIgdmlld0JveD0iMCAwIDQwNyA0MDciIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiIGNsYXNzPSIiPjxnPjxwYXRoIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZD0ibTg5LjE5OTIxOSAzN2MwLTEyLjEzMjgxMiA5LjQ2ODc1LTIxIDIxLjYwMTU2Mi0yMWg4OC44MDA3ODFjMTIuMTI4OTA3IDAgMjEuNTk3NjU3IDguODY3MTg4IDIxLjU5NzY1NyAyMXYyM2gxNnYtMjNjMC0yMC45NTMxMjUtMTYuNjQ0NTMxLTM3LTM3LjU5NzY1Ny0zN2gtODguODAwNzgxYy0yMC45NTMxMjUgMC0zNy42MDE1NjIgMTYuMDQ2ODc1LTM3LjYwMTU2MiAzN3YyM2gxNnptMCAwIiBmaWxsPSIjOTI5MjkyIiBkYXRhLW9yaWdpbmFsPSIjMDAwMDAwIiBzdHlsZT0iIiBjbGFzcz0iIj48L3BhdGg+PHBhdGggeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBkPSJtNjAuNjAxNTYyIDQwN2gxODkuMTk5MjE5YzE4LjI0MjE4OCAwIDMyLjM5ODQzOC0xNi4wNDY4NzUgMzIuMzk4NDM4LTM2di0yNDdoLTI1NHYyNDdjMCAxOS45NTMxMjUgMTQuMTU2MjUgMzYgMzIuNDAyMzQzIDM2em0xNDUuNTk3NjU3LTI0NC44MDA3ODFjMC00LjQxNzk2OSAzLjU4MjAzMS04IDgtOHM4IDMuNTgyMDMxIDggOHYxODljMCA0LjQxNzk2OS0zLjU4MjAzMSA4LTggOHMtOC0zLjU4MjAzMS04LTh6bS01OSAwYzAtNC40MTc5NjkgMy41ODIwMzEtOCA4LThzOCAzLjU4MjAzMSA4IDh2MTg5YzAgNC40MTc5NjktMy41ODIwMzEgOC04IDhzLTgtMy41ODIwMzEtOC04em0tNTkgMGMwLTQuNDE3OTY5IDMuNTgyMDMxLTggOC04czggMy41ODIwMzEgOCA4djE4OWMwIDQuNDE3OTY5LTMuNTgyMDMxIDgtOCA4cy04LTMuNTgyMDMxLTgtOHptMCAwIiBmaWxsPSIjOTI5MjkyIiBkYXRhLW9yaWdpbmFsPSIjMDAwMDAwIiBzdHlsZT0iIiBjbGFzcz0iIj48L3BhdGg+PHBhdGggeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBkPSJtMjAgMTA4aDI3MC4zOTg0MzhjMTEuMDQ2ODc0IDAgMjAtOC45NTMxMjUgMjAtMjBzLTguOTUzMTI2LTIwLTIwLTIwaC0yNzAuMzk4NDM4Yy0xMS4wNDY4NzUgMC0yMCA4Ljk1MzEyNS0yMCAyMHM4Ljk1MzEyNSAyMCAyMCAyMHptMCAwIiBmaWxsPSIjOTI5MjkyIiBkYXRhLW9yaWdpbmFsPSIjMDAwMDAwIiBzdHlsZT0iIiBjbGFzcz0iIj48L3BhdGg+PC9nPjwvc3ZnPg==" /></button> -->
                                    <!-- // 추후구현: 지역추가시 삭제버튼 -->
                                </div>
                            </div>
                            <!-- 추후구현: 지역 추가버튼
                            <button class="region-add-button" onclick="addRegion(this)" type="button">지역 추가</button>
                            // 추후구현: 지역 추가버튼 -->
                        </article>
                        <!-- // 지역 설정 -->
                    </section>
                    <section class="post edit-chef__post">
                        <h2 class="post__header">예약 게시글</h2>
                        <!-- 글 제목 -->
                        <article class="post-title-wrapper">
                            <h4 class="article-title">글 제목</h4>
                            <div class="input-wrapper">
                                <input value="{{post.title|default:""}}" class="post-title__content" name="title" type="text" placeholder="예약글 제목을 입력해주세요.">
                            </div>
                            </article>
                        <!-- // 글 제목 -->
                        <!-- 예약글 커버 이미지 업로드 -->
                        <article class="post-image-wrapper">
                            <h4>커버 이미지</h4>
                            <div class="input-wrapper image-input">
                                <img onerror="this.src='{% static 'image/Group 331.png' %}';" class="postCoverImage" name="postCoverImage" src="{{postCoverImage.attachment.url}}" alt="">
                                <input class="post-image__content" name="postCoverInput" type="file" multiple accept="image/*">
                            </div>
                        </article>
                        <!-- // 예약글 커버 이미지 -->

                        <!-- 셰프 소개 -->
                        <article class="chef-intro-wrapper">
                            <div class="chef-intro__header">
                                <h4 class="header__title">셰프 소개</h4>
                            </div>

                            <div class="textarea-wrapper">
                                <textarea name="introduce" class="chefInfoInput" maxlength="500">{{post.introduce|default:""}}</textarea>
                            </div>
                        </article>
                        <!-- // 셰프 소개 -->

                        <!-- 유의사항 -->
                        <article class="notice-wrapper">
                            <div class="notice__header">
                                <h4 class="article-title">유의사항</h4>
                            </div>

                            <div class="textarea-wrapper">
                                <textarea name="notice" class="noticeInput" maxlength="500" placeholder="ex)&#10;&#10;예약이 완료되면 안내 카톡을 보내드릴 예정입니다. 세부 요청사항은 카톡에서 말씀해주세요!&#10;&#10;코스별 안내사항&#10;&#10;코스 A: 준비시간 약 2시간&#10;&#10;※ 가격은 1인 기준입니다.&#10;&#10;※ 출장비 별도">{{post.notice|default:""}}</textarea>
                            </div>
                        </article>
                        <!-- // 유의사항 -->

                        <!-- 코스 정보 -->
                        <article class="course-wrapper">
                            <input type="hidden" name="courseCount" value="{{courses|length|default:1}}">
                            <div class="course__header">
                                <h4 class="article-title">코스 정보</h4>
                            </div>
                            <div class="course-info-all">
                                {% if not courses %}
                                <div class="courseInfo__eachCourse">
                                    <div class="course__content">
                                        <div class="course__info">
                                            <h4 class="course-name__title">코스 이름</h4>
                                            <div class="input-wrapper">
                                                <input class="course-info__title" name="courseTitle1" type="text" placeholder="ex) A코스(10인) 20,000원">
                                            </div>
                                            <h4 class="course-price__title">1인당 가격</h4>
                                            <div class="input-wrapper">
                                                <input class="course-info__price" name="coursePrice1" type="text" placeholder="인당 가격" value="">
                                            </div>
                                            <h4 class="course-name__title">코스 설명</h4>
                                            <div class="textarea-wrapper">
                                                <!-- 클래스명 변경: courseInfo__descr__input -> course-info__description-->
                                                <textarea class="course-info__description" name="courseDescribe1" maxlength="500" placeholder="ex)&#10;&#10;1. 메인반찬 : 돼지수육(800g), 돼지갈비조림(1kg), 소불고기(800g)&#10;&#10;2. 반찬 : 호박전/동태전, 탕수육, 궁중잡채, 겉절이김치, 콩나물무침 ...&#10;&#10;3. 후식 : 꿀떡, 인절미, 과일샐러드, 치킨텐더연어샐러드, 다슬기미역국&#10;&#10;8인~12인용 코스입니다.&#10;&#10;인원 및 요리 변경은 예약 후 말씀해주시면 가능한 범위 내에서 바꿔드립니다 ^^"></textarea>
                                            </div>
                                            <h4 class="course-name__title">코스 이미지</h4>
                                            <div class="course__img-wrapper textarea-wrapper">
                                                <div class="course__img-container">
                                                    <!-- <div class="course-image-add"> -->
                                                        <img src="{% static 'image/Group 333.png' %}" alt="">
                                                        <input style="cursor: pointer;" onchange="courseImageChange(this)" class="course-image__content" type="file" name="courseImg{{forloop.counter}}[]"  multiple accept="image/*">
                                                    <!-- </div> -->
                                                    {% for image in course.images %}
                                                    <div class="course-image">
                                                        <img class="course-image" name="courseImageTag" src="{{image.attachment.url}}" alt="" style="width:105px; height:105px;">
                                                        <!-- <input class="course__image-input" name="courseImageInput" class="course-image__content" type="file" name="courseImg{{forloop.counter}}[]" id="2" multiple accept="image/*"> -->
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                        <button class="course__delete" onclick="delCourse(this)" type="button"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnN2Z2pzPSJodHRwOi8vc3ZnanMuY29tL3N2Z2pzIiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeD0iMCIgeT0iMCIgdmlld0JveD0iMCAwIDMyOS4yNjkzMyAzMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiIGNsYXNzPSIiPjxnPjxnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iI2Y0NDMzNiI+PHBhdGggZD0ibTIxLjMzOTg0NCAzMjkuMzk4NDM4Yy01LjQ2MDkzOCAwLTEwLjkyNTc4Mi0yLjA4OTg0NC0xNS4wODIwMzItNi4yNS04LjM0Mzc1LTguMzM5ODQ0LTguMzQzNzUtMjEuODI0MjE5IDAtMzAuMTY0MDYzbDI4Ni41ODk4NDQtMjg2LjU5Mzc1YzguMzM5ODQ0LTguMzM5ODQ0IDIxLjgyNDIxOS04LjMzOTg0NCAzMC4xNjQwNjMgMCA4LjM0Mzc1IDguMzM5ODQ0IDguMzQzNzUgMjEuODI0MjE5IDAgMzAuMTY0MDYzbC0yODYuNTg5ODQ0IDI4Ni41OTM3NWMtNC4xODM1OTQgNC4xNzk2ODctOS42MjEwOTQgNi4yNS0xNS4wODIwMzEgNi4yNXptMCAwIiBmaWxsPSIjYmQwMDAwIiBkYXRhLW9yaWdpbmFsPSIjZjQ0MzM2IiBzdHlsZT0iIj48L3BhdGg+PHBhdGggZD0ibTMwNy45Mjk2ODggMzI5LjM5ODQzOGMtNS40NjA5MzggMC0xMC45MjE4NzYtMi4wODk4NDQtMTUuMDgyMDMyLTYuMjVsLTI4Ni41ODk4NDQtMjg2LjU5Mzc1Yy04LjM0Mzc1LTguMzM5ODQ0LTguMzQzNzUtMjEuODI0MjE5IDAtMzAuMTY0MDYzIDguMzM5ODQ0LTguMzM5ODQ0IDIxLjgyMDMxMy04LjMzOTg0NCAzMC4xNjQwNjMgMGwyODYuNTg5ODQ0IDI4Ni41OTM3NWM4LjM0Mzc1IDguMzM5ODQ0IDguMzQzNzUgMjEuODI0MjE5IDAgMzAuMTY0MDYzLTQuMTYwMTU3IDQuMTc5Njg3LTkuNjIxMDk0IDYuMjUtMTUuMDgyMDMxIDYuMjV6bTAgMCIgZmlsbD0iI2JkMDAwMCIgZGF0YS1vcmlnaW5hbD0iI2Y0NDMzNiIgc3R5bGU9IiI+PC9wYXRoPjwvZz48L2c+PC9zdmc+" /></button>
                                    </div>
                                </div>
                                {% else %}
                                {% for course in courses %}
                                <div class="courseInfo__eachCourse">
                                    <div class="course__content">
                                        <div class="course__info">
                                            <h4 class="course-name__title">코스 이름</h4>
                                            <div class="input-wrapper">
                                                <!-- 클래스명 변경:courseInfo__Name__input -> course-info__title  -->
                                                <input value="{{course.title}}" name="courseTitle{{forloop.counter}}" type="text" class="course-info__title" placeholder="ex) A코스(10인) 20,000원">
                                            </div>
                                            <h4 class="course-price__title">1인당 가격</h4>
                                            <!-- 클래스명 변경: courseInfo__price -> input-wrapper -->
                                            <div class="input-wrapper">
                                                <!-- 클래스명 변경: courseInfo__price__input -> course-info__price -->
                                                <input value="{{course.price}}" name="coursePrice{{forloop.counter}}" type="text" class="course-info__price" placeholder="인당 가격">
                                            </div>
                                            <!-- 클래스명 변경: courseInfo__menuDscr -> textarea-wrapper  -->
                                            <h4 class="course-name__title">코스 설명</h4>
                                            <div class="textarea-wrapper input-wrapper">
                                                <textarea class="course-info__description" name="courseDescribe{{forloop.counter}}" maxlength="500" placeholder="ex)&#10;&#10;1. 메인반찬 : 돼지수육(800g), 돼지갈비조림(1kg), 소불고기(800g)&#10;&#10;2. 반찬 : 호박전/동태전, 탕수육, 궁중잡채, 겉절이김치, 콩나물무침 ...&#10;&#10;3. 후식 : 꿀떡, 인절미, 과일샐러드, 치킨텐더연어샐러드, 다슬기미역국&#10;&#10;8인~12인용 코스입니다.&#10;&#10;인원 및 요리 변경은 예약 후 말씀해주시면 가능한 범위 내에서 바꿔드립니다 ^^">{{course.description|default:""}}</textarea>
                                            </div>
                                            <h4 class="course-name__title">코스 이미지</h4>
                                            <div class="course__img-wrapper">
                                                <div class="course__img-container">
                                                    <!-- <div class="course-image-add"> -->
                                                        <img src="{% static 'image/Group 333.png' %}" alt="">
                                                        <input style="cursor: pointer;" onchange="courseImageChange(this)" class="course-image__content" type="file" name="courseImg{{forloop.counter}}[]"  multiple accept="image/*">
                                                    <!-- </div> -->
                                                    {% for image in course.images %}
                                                    <div class="course-image">
                                                        <img class="course-image" name="courseImageTag" src="{{image.attachment.url}}" alt="" style="width:105px; height:105px;">
                                                        <!-- <input class="course__image-input" name="courseImageInput" class="course-image__content" type="file" name="courseImg{{forloop.counter}}[]" id="2" multiple accept="image/*"> -->
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                        <button class="course__delete" onclick="delCourse(this)" type="button"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnN2Z2pzPSJodHRwOi8vc3ZnanMuY29tL3N2Z2pzIiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeD0iMCIgeT0iMCIgdmlld0JveD0iMCAwIDMyOS4yNjkzMyAzMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiIGNsYXNzPSIiPjxnPjxnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iI2Y0NDMzNiI+PHBhdGggZD0ibTIxLjMzOTg0NCAzMjkuMzk4NDM4Yy01LjQ2MDkzOCAwLTEwLjkyNTc4Mi0yLjA4OTg0NC0xNS4wODIwMzItNi4yNS04LjM0Mzc1LTguMzM5ODQ0LTguMzQzNzUtMjEuODI0MjE5IDAtMzAuMTY0MDYzbDI4Ni41ODk4NDQtMjg2LjU5Mzc1YzguMzM5ODQ0LTguMzM5ODQ0IDIxLjgyNDIxOS04LjMzOTg0NCAzMC4xNjQwNjMgMCA4LjM0Mzc1IDguMzM5ODQ0IDguMzQzNzUgMjEuODI0MjE5IDAgMzAuMTY0MDYzbC0yODYuNTg5ODQ0IDI4Ni41OTM3NWMtNC4xODM1OTQgNC4xNzk2ODctOS42MjEwOTQgNi4yNS0xNS4wODIwMzEgNi4yNXptMCAwIiBmaWxsPSIjYmQwMDAwIiBkYXRhLW9yaWdpbmFsPSIjZjQ0MzM2IiBzdHlsZT0iIj48L3BhdGg+PHBhdGggZD0ibTMwNy45Mjk2ODggMzI5LjM5ODQzOGMtNS40NjA5MzggMC0xMC45MjE4NzYtMi4wODk4NDQtMTUuMDgyMDMyLTYuMjVsLTI4Ni41ODk4NDQtMjg2LjU5Mzc1Yy04LjM0Mzc1LTguMzM5ODQ0LTguMzQzNzUtMjEuODI0MjE5IDAtMzAuMTY0MDYzIDguMzM5ODQ0LTguMzM5ODQ0IDIxLjgyMDMxMy04LjMzOTg0NCAzMC4xNjQwNjMgMGwyODYuNTg5ODQ0IDI4Ni41OTM3NWM4LjM0Mzc1IDguMzM5ODQ0IDguMzQzNzUgMjEuODI0MjE5IDAgMzAuMTY0MDYzLTQuMTYwMTU3IDQuMTc5Njg3LTkuNjIxMDk0IDYuMjUtMTUuMDgyMDMxIDYuMjV6bTAgMCIgZmlsbD0iI2JkMDAwMCIgZGF0YS1vcmlnaW5hbD0iI2Y0NDMzNiIgc3R5bGU9IiI+PC9wYXRoPjwvZz48L2c+PC9zdmc+" /></button>
                                    </div>
                                </div>
                                {% endfor %}
                                {% endif %}
                            </div>
                            <button class="course-add-button" onclick="addCourse(this)" type="button">코스 추가</button>
                        </article>
                         <!-- // 코스 정보 -->
                    </section>
                </div>
            </div>
            <!-- 저장 버튼 -->
            <aside class="button">
                <button type="submit">저장</button>
            </aside>
            <!-- // 저장 버튼 -->
        </div>
    </form>    
{% endblock %}

{% block scripts %}

<script>
    // 코스 이미지 업로드 제우스
    function courseImageChange(e) {
        //const imageContainer = e.previousElementSibling;
        const imageContainer = document.getElementsByClassName('course__img-container')[0];
        const imageDivs = imageContainer.querySelectorAll("div.course-image");
        for (div of imageDivs) {
            div.remove();
        }
        for (let i = 0; i < e.files.length; i++) {
            const uploadFile = e.files[i];
            const div = document.createElement("div");
            div.classList.add("course-image");
            const img = document.createElement("img");
            img.classList.add("course-image");
            img.file = uploadFile;
            div.appendChild(img);
            imageContainer.appendChild(div);

            const reader = new FileReader();
            reader.onload = (function(aImg) {
                return function(e) {
                    aImg.src = e.target.result;
                }
            })(img);
            reader.readAsDataURL(uploadFile);
        }

    }

    //form data 모두 등록되었는지 확인
    function formCheck() {
        console.log("폼체크 함수");
        const count = document.getElementsByClassName('course-info-all')[0].childElementCount; //코스 개수 확인

        const returnVal = courseFillCheck(count);
        if(returnVal == true) {
            let emptyCourse = "";
        } else {
            console.log(returnVal);
            alert(`${returnVal}`+"입력을 완료해주세요!")
            return false;
        }
        
        let emptyInfo = new Array();
        const category = document.getElementsByName('category')[0].value;
        let postTitle = document.querySelector("input.post-title__content").value;
        let postImage = document.querySelector("img.postCoverImage").getAttribute('src');
        let postSpecText = document.querySelector("textarea.chefInfoInput").value;
        let postNotice = document.querySelector("textarea.noticeInput").value;

        if(category == 0) emptyInfo.push(" 카테고리 ");
        if(!postTitle) emptyInfo.push(" 글 제목 ");
        if(postImage == "/static/image/Group%20331.png") emptyInfo.push(" 커버 이미지 ");
        if(!postSpecText) emptyInfo.push(" 셰프소개 ");
        if(!postNotice) emptyInfo.push(" 유의사항 ");

        if(emptyInfo.length === 0){
            if(emptyCourse == "") return true;
            else return false;
        } else {
            alert(emptyCourse+`${emptyInfo}`+"내용을 채워주세요!");
            return false;
        } 

        if(emptyInfo.length !== 0){
            if(emptyCourse == "") {
                alert(`${emptyInfo}`+"내용을 채워주세요!");
                return false;
            } else {
                alert(emptyCourse +''+ `${emptyInfo}` + "내용을 채워주세요!");
                return false;
            }
        } else {
            return true;
        }
    }

    //가격 숫자만 입력
    const courseCnt = document.getElementsByClassName('course-info-all')[0].childElementCount; //코스 개수 확인
    for(let i = 0; i < courseCnt; i ++) {
        document.getElementsByClassName("course-info__price")[i].addEventListener('keyup', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, "");
        });
    }


    function checkNum(e) {
        var keyVal = e.keyCode;
        //e.target.value = e.target.value.replace(/[^0-9]/g, "");

        if(!((keyVal >= 48) && (keyVal <= 57))){
            alert("숫자만 입력가능합니다.");
            return false;
        } else return true;
    }

    // 입력된 카테고리 밎 지역 불러오기
    function loadSelector(selectorNode) {
        const selectorValue = selectorNode.getAttribute("value") || null
        if (selectorNode.getAttribute("value")) {
            const options = selectorNode.querySelectorAll("option");
            options[parseInt(selectorValue)].setAttribute("selected", "");
        }
    }
    loadSelector(document.querySelector("select[name=category]"));

    //지역 detail
    document.addEventListener("DOMContentLoaded", () => {
        getRegion(parseInt('{{post.region}}'));
        getRegionDetail(parseInt('{{post.region}}'), parseInt('{{post.regionDetail.id}}'));
    });

    document.getElementsByName('residence')[0].addEventListener('change', (event)=>{
        getRegionDetail(document.getElementsByName('residence')[0].value);
    });


    //지역 추가
    /*function addRegion(e) {
        const newRegion = document.getElementsByClassName("region-selection-wrapper");
        const regionNode = newRegion[0].cloneNode(true);
        regionNode.value = "";
        
        if (newRegion.length < 10) {
            const regionParent = document.getElementById('region-selection-all');
            regionParent.insertBefore(regionNode, regionParent.childNodes[regionParent.length]);
        } else {
            alert("지역은 최대 10개까지 등록할 수 있습니다.");
        }
    }

    //지역 삭제
    function delRegion(e) {
        //수정
        const regionCount = document.getElementById('region-selection-all').childElementCount;
        
        if( regionCount == 1) {
            alert("등록된 지역은 1개 이상이어야 합니다.");
        } else {
            var delConfirm = confirm("해당 지역을 삭제하시겠습니까?");
            if(delConfirm == true) {
                e.parentElement.remove();
            } else {
                alert("취소를 누르셨습니다.");
            }
        }
    }*/

    // 커버(단일) 이미지 업로드 미리보기
    const inputElement = document.getElementsByName("postCoverInput")[0];
    inputElement.addEventListener("change", function() {
        const imageFile = this.files[0];
        
        const img = document.getElementsByName("postCoverImage")[0];
        img.file = imageFile;
    
        const reader = new FileReader();
        reader.onload = (function(aImg) { return function(e) { aImg.src = e.target.result; }; })(img); // aImg
        reader.readAsDataURL(imageFile);
    }, false);

    // 코스 추가 버튼
    function addCourse(e) {
        const courseInfo = document.getElementsByClassName("courseInfo__eachCourse");
        const courseNode = courseInfo[0].cloneNode(true);
        courseNode.querySelector("input.course-info__title").value = "";
        courseNode.querySelector("input.course-info__price").value = "";
        courseNode.querySelector("textarea.course-info__description").value = "";
        const count = document.getElementsByClassName('course-info-all')[0].childElementCount;

        //코스 추가 개수 제한
        if (count < 10) {
            const returnVal = courseFillCheck(count);
            if(returnVal == true) {
                const courseParent = document.getElementsByClassName('course-info-all')[0];
                courseParent.insertBefore(courseNode, courseParent.childNodes[courseParent.length])
            } else {
                console.log(returnVal);
                alert(`${returnVal}`+"입력을 완료해주세요!")
            }
        } else {
            alert("코스는 10개까지 등록할 수 있습니다.");
        }
    }
    // 코스추가버튼 --> 코스 입력값 확인/제한
    function courseFillCheck(count) {
        const titleArr = new Array();
        const priceArr= new Array();
        const descriptionArr = new Array();
        const checkTitle = document.getElementsByClassName('course-info__title');
        const checkPrice = document.getElementsByClassName('course-info__price');
        const checkDescription = document.getElementsByClassName('course-info__description');
        for(let i = 0; i < count ; i ++) {
            titleArr.push(checkTitle[i]);
            priceArr.push(checkPrice[i]);
            descriptionArr.push(checkDescription[i]);
        }
        let alertMessage = new Array();
        if(checkTitle[count-1].value == "") alertMessage.push("코스 이름 ");
        if(checkPrice[count-1].value == "") alertMessage.push("코스 가격 ");
        if(checkDescription[count-1].value == "") alertMessage.push("코스 설명 ");
        
        if(alertMessage.length){ 
            return alertMessage;
        } else {
            return true;
        }
    }
    
    

    // 코스 삭제 버튼
    function delCourse(e) {
        const count = document.getElementsByClassName('course-info-all')[0].childElementCount; //코스 개수 확인
        if ( count === 1 ) {
            alert("코스는 1개 이상이어야 합니다.")
            return false;
        } else {
            let ask = confirm("삭제하시겠습니까?");
            if(ask == true) {
                e.parentElement.parentElement.remove();
            }
        }
    }

    // course count 코스 개수 변화 감지
    // courseTitle, coursePrice, courseDescribe, courseImg 인덱스 부여
    const courseCount = document.getElementsByName("courseCount")[0];
    const courseContainer = document.getElementsByClassName("course-info-all")[0];
    const courseObserver = new MutationObserver((mutations) => {
        console.log('mutation observer working')
        const eachCourse = document.getElementsByClassName("courseInfo__eachCourse")
        let courseLength = eachCourse.length;
        courseCount.value = courseLength;

        const courseTitles = document.querySelectorAll(".course-info__title");
        const coursePrices = document.querySelectorAll(".course-info__price");
        const courseDescriptions = document.querySelectorAll(".course-info__description"); // 클래스명 변경 반영하여 수정했습니다. courseInfo__menuDscr__input -> course-info__description
        const courseImgs = document.querySelectorAll(".course-image__content");

        for (i = 0; i < courseLength; i++) {
            let courseTitle = courseTitles[i];
            let coursePrice = coursePrices[i];
            let courseDescription = courseDescriptions[i];
            let courseImg = courseImgs[i];
            courseTitle.setAttribute("name", "courseTitle" + String(i+1));
            coursePrice.setAttribute("name", "coursePrice" + String(i+1));
            courseDescription.setAttribute("name", "courseDescription" + String(i+1));
            courseImg.setAttribute("name", "courseImg" + String(i+1) + "[]");
        }
    });
    const observerOption = {
        attributes: true,
        characterData: true,
        childList: true,
    };
    courseObserver.observe(courseContainer, observerOption);


    // 다중 이미지 업로드 미리보기
    const courseImageInput = document.getElementsByName("courseImageInput")[0];
    
    courseImageInput.addEventListener("change", function() {
        const courseImageContainer = document.getElementsByClassName("courseImageTag")[0];
        while (courseImageContainer.firstChild) { // 여기부터
            imageContainer.removeChild(courseImageContainer.firstChild);
        }
    
        for (let i = 0; i < this.files.length; i++) {
            const uploadFile = this.files[i];
    
            const img = document.createElement("img");
            /* img.classList.add("course-imgae_content"); */
            img.style.width = "200px";
            img.style.height = "150px";
            img.file = uploadFile;
            imageContainer.appendChild(img);
    
            const reader = new FileReader();
            reader.onload = (function(aImg) { return function(e) { aImg.src = e.target.result; }; })(img);
            reader.readAsDataURL(uploadFile);
        }
    }, false);

</script>

{% endblock %}